{% extends 'navbar.html' %}

{% block title %}Editar Receta{% endblock %}

{% block content %}
<!-- Incluimos Bootstrap desde CDN para usar sus clases -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    .card-form {
        background-color: #FFF8F5;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 20px;
        margin: 20px auto;
        max-width: 600px;
    }
    .card-form h2 {
        background-color: #FFD9C2;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        margin-bottom: 20px;
    }
</style>

<div class="container mt-4">
    <div class="card-form">
        <h2>Editar Receta</h2>
        <form method="post">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="mb-3">
                {{ form.nombre.label_tag }}
                <input type="text" name="{{ form.nombre.name }}" id="{{ form.nombre.id_for_label }}" value="{{ form.nombre.value|default_if_none:'' }}" class="form-control">
                {{ form.nombre.errors }}
            </div>

            <div class="mb-3">
                {{ form.tipo_comida.label_tag }}
                {{ form.tipo_comida }}
                {{ form.tipo_comida.errors }}
            </div>

            <div class="mb-3">
                {{ form.proteinas.label_tag }}
                <input type="number" name="{{ form.proteinas.name }}" id="{{ form.proteinas.id_for_label }}" value="{{ form.proteinas.value|default_if_none:'' }}" class="form-control">
                {{ form.proteinas.errors }}
            </div>

            <div class="mb-3">
                <label for="buscar-ingrediente">{{ form.ingredientes.label }}:</label>
                <input type="text" id="buscar-ingrediente" class="form-control" placeholder="Buscar ingrediente..." style="margin-bottom: 0.5em;">
                <div class="row" id="ingrediente-checkboxes">
                    {% for checkbox in form.ingredientes %}
                        <div class="col-md-4">
                            <div class="form-check">
                                {{ checkbox.tag }}
                                <label class="form-check-label" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {{ form.ingredientes.errors }}
                <p id="no-coincidencias" style="display: none; color: red;">No hay coincidencias</p>
            </div>

            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
        <a href="{% url 'detalle_receta' receta.pk %}" class="btn btn-secondary mt-3">Cancelar</a>
    </div>
</div>

<!-- Script para filtrar las opciones de ingredientes en tiempo real -->
<script>
document.getElementById('buscar-ingrediente').addEventListener('keyup', function() {
    var filtro = this.value.toLowerCase();
    var checkboxes = document.querySelectorAll('#ingrediente-checkboxes input[type="checkbox"]');
    var totalVisible = 0;
    checkboxes.forEach(function(checkbox) {
        var labelText = checkbox.parentNode.textContent.toLowerCase();
        if (labelText.includes(filtro)) {
            checkbox.parentNode.parentNode.style.display = '';
            totalVisible++;
        } else {
            checkbox.parentNode.parentNode.style.display = 'none';
        }
    });
    var noMatchMsg = document.getElementById('no-coincidencias');
    noMatchMsg.style.display = totalVisible === 0 ? 'block' : 'none';
});
</script>

{% if exito %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mostrarSuccessModal();
    setTimeout(() => {
      window.location.href = "{% url 'detalle_receta' receta.pk %}";
    }, 1000);
  });
</script>
{% endif %}
{% endblock %}
