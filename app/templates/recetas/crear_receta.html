{% extends 'navbar.html' %}

{% block title %}Crear Receta{% endblock %}

{% block content %}
<h1>Crear Receta</h1>

<form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- Campo nombre -->
    <p>
        {{ form.nombre.label_tag }}<br>
        {{ form.nombre }}
        {{ form.nombre.errors }}

    </p>

    <!-- Campo tipo_comida -->
    <p>
        {{ form.tipo_comida.label_tag }}<br>
        {{ form.tipo_comida }}
        {{ form.tipo_comida.errors }}

    </p>

    <!-- Campo proteinas -->
    <p>
        {{ form.proteinas.label_tag }}<br>
        {{ form.proteinas }}
        {{ form.proteinas.errors }}

    </p>

    <!-- Campo ingredientes con buscador -->
    <p>
        <label for="buscar-ingrediente">{{ form.ingredientes.label }}:</label><br>
        <!-- Aquí está el buscador -->
        <input
            type="text"
            id="buscar-ingrediente"
            placeholder="Buscar ingrediente..."
            style="margin-bottom: 0.5em;"
        />
        <br>
        <!-- Aquí se renderizan los checkboxes de ingredientes -->
        {{ form.ingredientes }}
        {{ form.ingredientes.errors }}

        <p id="no-coincidencias" style="display: none; color: red;">
            No hay coincidencias
        </p>
    </p>

    <button type="submit">Guardar</button>
</form>

<!-- Script para filtrar las opciones de ingredientes en tiempo real -->
<script>
document.getElementById('buscar-ingrediente').addEventListener('keyup', function() {
    var filtro = this.value.toLowerCase();
    // Buscamos todos los checkboxes dentro del div que Django genera
    var checkboxes = document.querySelectorAll('#id_ingredientes input[type="checkbox"]');
    var totalVisible = 0;

    checkboxes.forEach(function(checkbox) {
        // El texto del <label> está junto al checkbox
        var labelText = checkbox.parentNode.textContent.toLowerCase();
        if (labelText.includes(filtro)) {
            checkbox.parentNode.style.display = '';
            totalVisible++;
        } else {
            checkbox.parentNode.style.display = 'none';
        }
    });
        // Mostrar el mensaje "No hay coincidencias" si totalVisible == 0
    var noMatchMsg = document.getElementById('no-coincidencias');
    if (totalVisible === 0) {
        noMatchMsg.style.display = 'block';
    } else {
        noMatchMsg.style.display = 'none';
    }
});
</script>
{% endblock %}
