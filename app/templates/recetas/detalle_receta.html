{% extends 'navbar.html' %}

{% block title %}Detalle Receta{% endblock %}

{% block content %}
<!-- Incluimos Bootstrap desde CDN para usar sus clases -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    .card-detalle {
        background-color: #FFF8F5;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin: 20px auto;
        max-width: 600px;
    }
    .card-detalle h2 {
        background-color: #FFD9C2;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        margin-bottom: 20px;
    }
    .btn-action {
        margin-right: 5px;
    }
</style>

<div class="container mt-4">
    <div class="card-detalle">
        <h2>{{ receta.nombre }}</h2>
        <p><strong>Tipo de Comida:</strong></p>
        <ul>
            {% for tipo in receta.tipo_comida.all %}
            <li>{{ tipo.nombre }}</li>
            {% endfor %}
        </ul>
        <p><strong>Proteínas:</strong> {{ receta.proteinas }}</p>

        {% if receta.descripcion %}
            <p><strong>Descripción:</strong> {{ receta.descripcion }}</p>
        {% endif %}
        
        <div>
            <h4>Ingredientes</h4>
            <ul>
                {% for ingrediente in receta.ingredientes.all %}
                <li>{{ ingrediente.nombre }} (Frecuencia: {{ ingrediente.frec }})</li>
                {% endfor %}
            </ul>
        </div>
        <div class="d-flex justify-content-between mt-3">
            <form method="post" style="display:inline;">
                {% csrf_token %}
                <button type="button"
                        class="btn btn-danger btn-action"
                        style="width:100%;"
                        data-url="{% url 'detalle_receta' receta.pk %}"
                        onclick="confirmarEliminacion(this)">
                    Eliminar
                </button>
            </form>
            <div>
                <a href="{% url 'editar_receta' receta.pk %}" class="btn btn-warning btn-action">Editar</a>
                <a href="{% url 'listado_recetas' %}" class="btn btn-primary btn-action">Volver a la lista</a>
            </div>
        </div>
    </div>
</div>


<!-- Modal de Confirmación para eliminar receta -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center animate-zoom" style="border-radius: 15px; background-color: #FFF8F5;">
        <div class="modal-header">
          <h5 class="modal-title w-100" id="confirmDeleteModalLabel">¿Eliminar receta?</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>¿Estás seguro de que deseas eliminar esta receta?</p>
          <form id="deleteForm" method="post">
            {% csrf_token %}
            <button type="submit" name="delete" class="btn btn-danger">Sí, eliminar</button>
            <button type="button" class="btn btn-secondary ms-2" data-bs-dismiss="modal">Cancelar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Almacena dinámicamente la acción del formulario
  function confirmarEliminacion(button) {
      const url = button.getAttribute('data-url');
      const form = document.getElementById('deleteForm');
      form.action = url;
      const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
      modal.show();
  }
  </script>
  
{% endblock %}
